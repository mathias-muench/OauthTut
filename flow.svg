<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="641px" preserveAspectRatio="none" style="width:1070px;height:641px;background:#FFFFFF;" version="1.1" viewBox="0 0 1070 641" width="1070px" zoomAndPan="magnify"><defs/><g><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="55" x2="55" y1="36.2969" y2="606.6875"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="363" x2="363" y1="36.2969" y2="606.6875"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="714" x2="714" y1="36.2969" y2="606.6875"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="851" x2="851" y1="36.2969" y2="606.6875"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1033.5" x2="1033.5" y1="36.2969" y2="606.6875"/><rect fill="#FFFFFF" height="30.2969" style="stroke:#000000;stroke-width:1.0;" width="71" x="20" y="5"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="57" x="27" y="24.9951">Browser</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#000000;stroke-width:1.0;" width="71" x="20" y="605.6875"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="57" x="27" y="625.6826">Browser</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#000000;stroke-width:1.0;" width="53" x="337" y="5"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="39" x="344" y="24.9951">Portal</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#000000;stroke-width:1.0;" width="53" x="337" y="605.6875"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="39" x="344" y="625.6826">Portal</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#000000;stroke-width:1.0;" width="153" x="638" y="5"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="139" x="645" y="24.9951">Authorization Server</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#000000;stroke-width:1.0;" width="153" x="638" y="605.6875"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="139" x="645" y="625.6826">Authorization Server</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#000000;stroke-width:1.0;" width="60" x="821" y="5"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="46" x="828" y="24.9951">Broker</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#000000;stroke-width:1.0;" width="60" x="821" y="605.6875"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="46" x="828" y="625.6826">Broker</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#000000;stroke-width:1.0;" width="61" x="1003.5" y="5"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="47" x="1010.5" y="24.9951">Device</text><rect fill="#FFFFFF" height="30.2969" style="stroke:#000000;stroke-width:1.0;" width="61" x="1003.5" y="605.6875"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="47" x="1010.5" y="625.6826">Device</text><polygon fill="#000000" points="351.5,63.4297,361.5,67.4297,351.5,71.4297,355.5,67.4297" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="55.5" x2="357.5" y1="67.4297" y2="67.4297"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="70" x="62.5" y="62.3638">Login Page</text><polygon fill="#000000" points="66.5,92.5625,56.5,96.5625,66.5,100.5625,62.5,96.5625" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="60.5" x2="362.5" y1="96.5625" y2="96.5625"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201" x="72.5" y="91.4966">Redirect to authorization server</text><polygon fill="#000000" points="702.5,121.6953,712.5,125.6953,702.5,129.6953,706.5,125.6953" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="55.5" x2="708.5" y1="125.6953" y2="125.6953"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="258" x="62.5" y="120.6294">Authorization code request to /authorize</text><polygon fill="#000000" points="66.5,150.8281,56.5,154.8281,66.5,158.8281,62.5,154.8281" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="60.5" x2="713.5" y1="154.8281" y2="154.8281"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="216" x="72.5" y="149.7622">Redirect to authentication prompt</text><polygon fill="#000000" points="702.5,179.9609,712.5,183.9609,702.5,187.9609,706.5,183.9609" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="55.5" x2="708.5" y1="183.9609" y2="183.9609"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="176" x="62.5" y="178.895">Authentication and consent</text><polygon fill="#000000" points="66.5,209.0938,56.5,213.0938,66.5,217.0938,62.5,213.0938" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="60.5" x2="713.5" y1="213.0938" y2="213.0938"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="160" x="72.5" y="208.0278">Redirect to callback page</text><polygon fill="#000000" points="351.5,238.2266,361.5,242.2266,351.5,246.2266,355.5,242.2266" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="55.5" x2="357.5" y1="242.2266" y2="242.2266"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="217" x="62.5" y="237.1606">Forward authorization code in URL</text><polygon fill="#000000" points="702.5,267.3594,712.5,271.3594,702.5,275.3594,706.5,271.3594" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="363.5" x2="708.5" y1="271.3594" y2="271.3594"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="327" x="370.5" y="266.2935">Send authorization code and client secret to /token</text><polygon fill="#000000" points="374.5,296.4922,364.5,300.4922,374.5,304.4922,370.5,300.4922" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="368.5" x2="713.5" y1="300.4922" y2="300.4922"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="120" x="380.5" y="295.4263">Access token (JWT)</text><polygon fill="#000000" points="66.5,325.625,56.5,329.625,66.5,333.625,62.5,329.625" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="60.5" x2="362.5" y1="329.625" y2="329.625"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="284" x="72.5" y="324.5591">Redirect to portal page with JWT in set cookie</text><polygon fill="#000000" points="351.5,354.7578,361.5,358.7578,351.5,362.7578,355.5,358.7578" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="55.5" x2="357.5" y1="358.7578" y2="358.7578"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="264" x="62.5" y="353.6919">Request with access token (JWT) in cookie</text><line style="stroke:#000000;stroke-width:1.0;" x1="363.5" x2="405.5" y1="387.8906" y2="387.8906"/><line style="stroke:#000000;stroke-width:1.0;" x1="405.5" x2="405.5" y1="387.8906" y2="400.8906"/><line style="stroke:#000000;stroke-width:1.0;" x1="364.5" x2="405.5" y1="400.8906" y2="400.8906"/><polygon fill="#000000" points="374.5,396.8906,364.5,400.8906,374.5,404.8906,370.5,400.8906" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="169" x="370.5" y="382.8247">Locally validates JWT token</text><polygon fill="#000000" points="66.5,426.0234,56.5,430.0234,66.5,434.0234,62.5,430.0234" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="60.5" x2="362.5" y1="430.0234" y2="430.0234"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="62" x="72.5" y="424.9575">Response</text><polygon fill="#000000" points="839,455.1563,849,459.1563,839,463.1563,843,459.1563" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="55.5" x2="845" y1="459.1563" y2="459.1563"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="264" x="62.5" y="454.0903">Request with access token (JWT) in cookie</text><line style="stroke:#000000;stroke-width:1.0;" x1="851" x2="893" y1="488.2891" y2="488.2891"/><line style="stroke:#000000;stroke-width:1.0;" x1="893" x2="893" y1="488.2891" y2="501.2891"/><line style="stroke:#000000;stroke-width:1.0;" x1="852" x2="893" y1="501.2891" y2="501.2891"/><polygon fill="#000000" points="862,497.2891,852,501.2891,862,505.2891,858,501.2891" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="169" x="858" y="483.2231">Locally validates JWT token</text><polygon fill="#000000" points="1022,526.4219,1032,530.4219,1022,534.4219,1026,530.4219" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="851" x2="1028" y1="530.4219" y2="530.4219"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="52" x="858" y="525.356">Request</text><polygon fill="#000000" points="862,555.5547,852,559.5547,862,563.5547,858,559.5547" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="856" x2="1033" y1="559.5547" y2="559.5547"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="62" x="868" y="554.4888">Response</text><polygon fill="#000000" points="66.5,584.6875,56.5,588.6875,66.5,592.6875,62.5,588.6875" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="60.5" x2="850" y1="588.6875" y2="588.6875"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="62" x="72.5" y="583.6216">Response</text><!--MD5=[b9766c9ba4f910086683341709737231]
@startuml

!theme plain

Browser -> Portal : Login Page
Browser <- Portal : Redirect to authorization server
Browser -> "Authorization Server" : Authorization code request to /authorize
Browser <- "Authorization Server" : Redirect to authentication prompt
Browser -> "Authorization Server" : Authentication and consent
Browser <- "Authorization Server" : Redirect to callback page
Browser -> Portal : Forward authorization code in URL
Portal -> "Authorization Server" : Send authorization code and client secret to /token
Portal <- "Authorization Server" : Access token (JWT)
Browser <- Portal : Redirect to portal page with JWT in set cookie
Browser -> Portal : Request with access token (JWT) in cookie
Portal -> Portal: Locally validates JWT token
Browser <- Portal : Response
Browser -> Broker : Request with access token (JWT) in cookie
Broker -> Broker: Locally validates JWT token
Broker -> Device : Request
Broker <- Device : Response
Browser <- Broker : Response


@enduml

@startuml








<style>
  root {
    BackgroundColor white
    FontColor black
    FontName Verdana
    HyperLinkColor blue
    LineColor black
    LineThickness 1
    Margin 5
  }
  caption {
    LineThickness 0
  }
  footer {
    LineThickness 0
  }
  header {
    LineThickness 0
  }
  node {
    MaximumWidth 300
  }
  title {
    FontSize 22
    LineThickness 0
  }
</style>

skinparam ArrowLollipopColor black
skinparam BackgroundColor white
skinparam DefaultFontName Verdana
skinparam DefaultMonospacedFontName Courier
skinparam LifelineStrategy nosolid
skinparam ParticipantPadding 10
skinparam SequenceLifeLineBorderColor black
skinparam Shadowing false
skinparam UseBetaStyle true

skinparam Activity {
  BackgroundColor white
  BarColor black
  BorderColor black
  FontColor black
  FontName Verdana
}
skinparam Boundary {
  FontColor black
}
skinparam Box {
  Padding 5
}
skinparam CircledCharacter {
  FontColor black
  FontName Courier
  Radius 9
}
skinparam Class {
  BackgroundColor white
  BorderColor black
  FontColor black
  FontName Verdana
}
skinparam ClassAttribute {
  FontColor black
  FontName Verdana
}
skinparam ClassStereotype {
  FontColor black
  FontName Verdana
}
skinparam Footer {
  FontColor black
  FontName Verdana
}
skinparam Header {
  FontColor black
  FontName Verdana
}
skinparam Hyperlink {
  Color blue
}
skinparam IconPackage {
  Color black
  BackgroundColor white
}
skinparam IconPrivate {
  Color black
  BackgroundColor white
}
skinparam IconProtected {
  Color black
  BackgroundColor white
}
skinparam IconPublic {
  Color black
  BackgroundColor white
}
skinparam Note {
  FontColor black
  FontName Verdana
}
skinparam Package {
  BorderColor black
  FontColor black
  FontName Verdana
}
skinparam State {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeA {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeC {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeE {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeI {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeN {
  BackgroundColor white
  BorderColor black
}
skinparam UseCaseStereoType {
  FontColor black
  FontName Verdana
}

Browser -> Portal : Login Page
Browser <- Portal : Redirect to authorization server
Browser -> "Authorization Server" : Authorization code request to /authorize
Browser <- "Authorization Server" : Redirect to authentication prompt
Browser -> "Authorization Server" : Authentication and consent
Browser <- "Authorization Server" : Redirect to callback page
Browser -> Portal : Forward authorization code in URL
Portal -> "Authorization Server" : Send authorization code and client secret to /token
Portal <- "Authorization Server" : Access token (JWT)
Browser <- Portal : Redirect to portal page with JWT in set cookie
Browser -> Portal : Request with access token (JWT) in cookie
Portal -> Portal: Locally validates JWT token
Browser <- Portal : Response
Browser -> Broker : Request with access token (JWT) in cookie
Broker -> Broker: Locally validates JWT token
Broker -> Device : Request
Broker <- Device : Response
Browser <- Broker : Response


@enduml

PlantUML version 1.2021.9(Sun Jul 25 12:13:56 CEST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>